<% presenter = @report.result.presenter %>
<article class="gap-4">
    <header class="flex flex-col lg:flex-row justify-between px-8 border-b border-gray-600 pb-4">
        <h1 class="text-3xl font-bold" title="<%= @report.query %>"><%= @report.query.truncate_words(6) %></h1>
        <div class="text-sm flex flex-col text-gray-500 dark:text-gray-400">
        <% if @report.region.present? %>
            <div>Region: <strong><%= @report.region.titleize %></strong></div>
        <% end %>
        <% if @report.cohort.present? %>
            <div>Cohort: <strong><%= @report.cohort %></strong></div>
        <% end %>
        <% if @report.brand_info.present? %>
            <div>Brand: <strong><%= @report.brand_info %></strong></div>
        <% end %>
        </div>  
    </header>


  <% if presenter.brand_health? %>        
        <%= render partial: "results/health", locals: { presenter: presenter }   %>        
    <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 p-4">    
    <% if presenter.perception? %>
        <%= render partial: "results/perception", locals: { presenter: presenter }   %>        
    <% end %>

    <div class="leaders p-6">        
        <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-4">Leaders</h2>
        
        <p class="mb-6 text-gray-500 dark:text-gray-400 text-lg">


            <% if presenter.brand_health&.indicator&.in?(%i(best)) %>
                <span>ğŸš€ Your brand is the leader for <%= @report.query %></span>
            <% end %>


            <% if presenter.brand_health&.indicator&.in?(%i(excellent)) %>
                <span>ğŸ‘ Your brand in the in top quartile of the leaders 
                <% if presenter.brand_health&.rank&.present? %>
                    and it's ranked #<%= presenter.brand_health.rank %>
                <% end %>
                </span>
            <% end %>

            <% if presenter.brand_health&.indicator&.in?(%i(good)) %>
                <span>ğŸ’ª Your brand is among the leaders
                <% if presenter.brand_health&.rank&.present? %>
                    and it's ranked #<%= presenter.brand_health.rank %>
                <% end %>                 
                </span>
            <% end %>

            <% if presenter.brand_health&.indicator&.in?(%i(neutral)) %>
                <span>ğŸ˜ Your brand is not among the leaders, but is recommended sometimes</span>
            <% end %>

            <% if presenter.brand_health&.indicator&.in?(%i(bad)) %>
                <span>ğŸ˜” Your brand is not among the leaders and it's not recommended often</span>
            <% end %>

            <%= presenter.leaders_chart %>
        </p>        
    </div>
  </div>


  <div class="p-8">
    <% if presenter.domains? %>           
        <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-4">Domain breakdown</h2>
        <p class="mb-6 text-gray-500 dark:text-gray-400 text-lg">
            These are the domains that ChatGPT consults more often to give recommendations about your and your competitors brand. <span class="font-bold">Creating relevant content on these domains will help improve your brand health.</span>
        </p>
        <%= presenter.domain_breakdown_chart %>        
    <% end %> 
  </div>

  <div class="p-8">
    <% if presenter.domains? %>           
        <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-4">Most influential sources</h2>
        <p class="mb-6 text-gray-500 dark:text-gray-400 text-lg">
            ChatGPT used these articles to give recommendations about you and your competitors. Analyzing its tone and content and mimicking their strategies will help you improve your brand health.
        </p>
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
        <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                    <th scope="col" class="px-6 py-3">Source</th>
                    <th scope="col" class="px-6 py-3">Mentions</th>
                    <th scope="col" class="px-6 py-3">Brands Mentioned</th>
                </tr>
            </thead>
            <tbody>
                <% presenter.relevant_content.each do |url, data| %>
                    <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                        <td class="px-6 py-4">
                            <%= link_to data[:domain] + data[:path], "https://" + url, class: "hover:underline", target: "_blank" %>
                        </td>
                        <td class="px-6 py-4">
                            <%= data[:count] %>
                        </td>
                        <td class="px-6 py-4">
                            <%= data[:names].join(", ") %>
                        </td>
                    </tr>
                <% end %>
            </tbody>
        </table>
    </div>
    <% end %> 
  </div>
</article>
