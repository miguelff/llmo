<% presenter = @report.result.presenter %>
<article class="gap-4">
    <header class="flex flex-col lg:flex-row justify-between px-8 border-b border-zinc-200 dark:border-zinc-800 pb-4">
        <h1 class="text-3xl font-bold" title="<%= @report.query %>"><%= @report.query.truncate_words(6) %></h1>
        <div class="text-sm flex flex-col text-zinc-500 dark:text-zinc-400">
        <% if @report.region.present? %>
            <div>Region: <strong><%= @report.region.titleize %></strong></div>
        <% end %>
        <% if @report.cohort.present? %>
            <div>Cohort: <strong><%= @report.cohort %></strong></div>
        <% end %>
        <% if @report.brand_info.present? %>
            <div>Brand: <strong><%= @report.brand_info %></strong></div>
        <% end %>
        </div>  
    </header>


  <% if presenter.brand_health? %>        
        <%= render partial: "results/health", locals: { presenter: presenter }   %>        
    <% end %>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 p-8">    
    <% if presenter.perception? %>
        <%= render partial: "results/perception", locals: { presenter: presenter }   %>        
    <% end %>

    <%= render partial: "results/leaders", locals: { presenter: presenter }   %>
  </div>


  <div class="p-8">
    <% if presenter.domains? %>           
        <h2 class="text-3xl font-semibold text-zinc-950 dark:text-white mb-4">Domain breakdown</h2>
        <p class="mb-6 text-zinc-500 dark:text-zinc-400 text-lg">
            These are the domains that ChatGPT consults more often to give recommendations about your and your competitors brand. <span class="font-bold">Creating relevant content on these domains will help improve your brand health.</span>
        </p>
        <%= presenter.domain_breakdown_chart %>        
    <% end %> 
  </div>

  <div class="p-8">
    <% if presenter.domains? %>           
        <h2 class="text-3xl font-semibold text-zinc-950 dark:text-white mb-4">Most influential sources</h2>
        <p class="mb-6 text-zinc-500 dark:text-zinc-400 text-lg">
            ChatGPT used these articles to give recommendations about you and your competitors. Analyzinc its tone and content and mimicking their strategies will help you improve your brand health.
        </p>
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
        <table class="w-full text-sm text-left text-zinc-500 dark:text-zinc-400">
            <thead class="text-xs text-zinc-800 uppercase bg-zinc-50 dark:bg-zinc-800 dark:text-zinc-400">
                <tr>
                    <th scope="col" class="px-6 py-3">Source</th>
                    <th scope="col" class="px-6 py-3">Mentions</th>
                    <th scope="col" class="px-6 py-3">Brands Mentioned</th>
                </tr>
            </thead>
            <tbody>
                <% presenter.relevant_content.each do |url, data| %>                    
                    <tr class="bg-white border-b dark:bg-zinc-900 dark:border-zinc-800 hover:bg-zinc-50 dark:hover:bg-zinc-600">
                        <td class="px-6 py-4">
                            <a href="<%= url %>" class="hover:underline" target="_blank"><%= url %></a>                            
                        </td>
                        <td class="px-6 py-4">
                            <%= data[:count] %>
                        </td>
                        <td class="px-6 py-4">
                            <%= data[:names].join(", ") %>
                        </td>
                    </tr>                    
                <% end %>
            </tbody>
        </table>
    </div>
    <% end %> 
  </div>
</article>
